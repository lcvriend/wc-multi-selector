<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>multiselector component test</title>
    <link rel="stylesheet" href="static/stylesheet.css">
    <link rel="stylesheet" href="static/prism.css">
</head>
<body>
<header>
    <h1>Multi-Selector</h1>
</header>
<main>
    <section class="top-example">
        <form>
            <label for="courses">
                Agricultural courses (demo)
                <multi-selector src="data/courses.json" name="courses"></multi-selector>
            </label>
        </form>
    </section>
    <section>
        <div>
            <h3>Web component demo</h3>
            <p><code>&lt;multi-selector&gt;</code> is a web component that lets a user select multiple options from a drop-down menu:</p>
            <ul>
                <li>Arbitrarily nested groups of options</li>
                <li>Searchable groups/values</li>
                <li>Keyboard navigation</li>
                <li>Reads options from JSON or markup</li>
                <li>Adaptive styling with dark mode support</li>
                <li>VanillaJS (no dependencies)</li>
            </ul>
            <p>This page contains several examples of how to use this web component. <a href="https://github.com/lcvriend/wc-multi-selector">View on GitHub</a>.</p>
        </div>
        <div>
            <h4>Contents</h4>
            <ul>
                <li><a href="#json">Load from JSON</a></li>
                <li><a href="#options-in-markup">Options in markup</a></li>
                <li><a href="#control-navigation">Control & navigation</a></li>
                <li><a href="#form-integration">Form integration</a></li>
                <li><a href="#component-behavior">Component behavior and events</a></li>
                <li><a href="#styling">Styling and theming</a></li>
                <li><a href="#empty">Programmatic data management</a></li>
                <li><a href="#css-reference">CSS-reference</a></li>
                <li><a href="#alternatives">Alternatives</a></li>
            </ul>
        </div>
    </section>

<!-- MARK: json -->
    <section>
        <div>
            <h3 id="json">Load from JSON</h3>
            <p>Supply the data as JSON using the <code>src</code> attribute of <code>&lt;multi-selector&gt;</code>.</p>
            <h4>Expected data structure</h4>
            <p>Each item should follow this JSON structure:</p>
            <p><code>{
                "label": "Display text",  // optional<br>
                "value": "unique_id",     // required<br>
                "children": []            // optional for leaf nodes
            }</code></p>
            <p>See <a href="data/fallacies.json">fallacies.json</a> for an example. When no label is provided, the value serves as the fallback display text.</p>

            <h4>Preselecting options</h4>
            <p>Add <code>"selected": true</code> to any leaf node to preselect it. This property is ignored on group nodes since their selection state derives from their children.</p>

            <h4>Simplified data formats</h4>
            <p><code>&lt;multi-selector&gt;</code> automatically converts simpler formats:</p>
            <ul>
                <li>Flat arrays: <code>["option1", "option2"]</code></li>
                <li>Nested objects: <code>{"Group": ["item1", "item2"]}</code></li>
            </ul>
            <p>See <a href="data/albums.json">albums.json</a> and <a href="data/countries.json">countries.json</a> for examples of alternative formats.</p>
        </div>
        <div>
            <multi-selector src="data/countries.json" name="countries"></multi-selector>
            <h4>Code</h4>
<pre><code class="language-html">  &lt!-- html --&gt;
  &lt;multi-selector
    src="data/countries.json"
    name="countries"&gt;
  &lt;/multi-selector&gt;</code></pre>
</div>
    </section>

<!-- MARK: dom -->
    <section>
        <div>
            <h3 id="options-in-markup">Define options in markup</h3>
            <p>Populate <code>&lt;multi-selector&gt;</code> using standard <code>&lt;option&gt;</code> tags. Each option uses its text content as the value unless you provide a <code>value</code> attribute.</p>
            <p>Dynamically adding options to the DOM will update the component automatically.</p>
            <blockquote>Note that DOM updates trigger a complete component <i>re-render</i>.</blockquote>
            <h4 id="categories-with-optgroup">Grouping with optgroup</h4>
            <p>Use <code>&lt;optgroup&gt;</code> tags to create option groups. This component supports nested <code>&lt;optgroup&gt;</code> elements, extending beyond the standard HTML behavior.</p>
            <p>Group labels and values default to the element's <code>textContent</code>, but can be overridden with <code>label</code> and <code>value</code> attributes.</p>
        </div>
        <div>
            <p>Add a color to the color selector:</p>
            <div>
                <input type="text" name="color" id="color" placeholder="Enter a color...">
                <button id="add-color">Add color</button>
            </div>
            <multi-selector name="colors">
                <option>Red</option>
                <option>Yellow</option>
                <option>Green</option>
                <option>Blue</option>
            </multi-selector>
            <h4>Code</h4>
<pre><code class="language-html">  &lt!-- html --&gt;
  &lt;multi-selector name="colors"&gt;
    &lt;option&gt;Red&lt;/option&gt;
    &lt;option&gt;Yellow&lt;/option&gt;
    &lt;option&gt;Green&lt;/option&gt;
    &lt;option&gt;Blue&lt;/option&gt;
  &lt;/multi-selector&gt;</code></pre>
            <multi-selector name="instruments">
                <optgroup label="String instruments" value="string">
                    <optgroup label="Guitar" value="guitar">
                        <option value="acoustic">Acoustic</option>
                        <option value="electric">Electric</option>
                    </optgroup>
                    <option value="violin">Violin</option>
                    <option value="cello">Cello</option>
                </optgroup>
                <optgroup label="Wind instruments" value="wind">
                    <optgroup label="Brass instruments" value="brass">
                        <option value="trumpet">Trumpet</option>
                        <option value="trombone">Trombone</option>
                        <option value="saxophone">Saxophone</option>
                    </optgroup>
                    <optgroup label="Woodwind instruments" value="woodwind">
                        <option value="flute">Flute</option>
                        <option value="clarinet">Clarinet</option>
                    </optgroup>
                </optgroup>
                <optgroup label="Percussion instruments" value="percussion">
                    <option value="drums">Drums</option>
                    <option value="xylophone">Xylophone</option>
                    <option value="marimba">Marimba</option>
                </optgroup>
            </multi-selector>
            <h4>Code</h4>
<pre><code class="language-html">  &lt!-- html --&gt;
  &lt;multi-selector name="instruments"&gt;
  &lt;optgroup label="String instruments" value="string"&gt;
      &lt;optgroup label="Guitar" value="guitar"&gt;
          &lt;option value="acoustic"&gt;Acoustic&lt;/option&gt;
          &lt;option value="electric"&gt;Electric&lt;/option&gt;
      &lt;/optgroup&gt;
      &lt;option value="violin"&gt;Violin&lt;/option&gt;
      &lt;option value="cello"&gt;Cello&lt;/option&gt;
  &lt;/optgroup&gt;
  [...]
  &lt;/multi-selector&gt;</code></pre>
        </div>
    </section>

<!-- MARK: navigation -->
    <section>
        <div>
            <h3 id="control-navigation">Controls & navigation</h3>
            <ul>
                <li>Select or deselect entire groups using group checkboxes</li>
                <li>Filter options by keyword using the search input</li>
                <li>Toggle the <kbd>[val]</kbd> button to search values only (excluding group names)</li>
            </ul>
            <h4>Filtering and folding</h4>
            <ul>
                <li>Show only selected options: click <kbd>☑</kbd> or press <kbd>Ctrl</kbd>+<kbd>\</kbd></li>
                <li>Clear all filters: click <kbd>✕</kbd> or press <kbd>Ctrl</kbd>+<kbd>/</kbd></li>
                <li>Fold or unfold all groups: use <kbd>+</kbd>/<kbd>-</kbd> buttons or press <kbd>Ctrl</kbd>+<kbd>[</kbd>/<kbd>Ctrl</kbd>+<kbd>]</kbd></li>
            </ul>
            <h4>Keyboard navigation</h4>
            <ul>
                <li>Navigate with <kbd>↑</kbd> <kbd>↓</kbd> <kbd>←</kbd> <kbd>→</kbd>, <kbd>Home</kbd>, <kbd>End</kbd>, and <kbd>Tab</kbd></li>
                <li>Close the dropdown with <kbd>Esc</kbd></li>
            </ul>
        </div>
        <div>
            <multi-selector src="data/fallacies.json" name="fallacies"></multi-selector>
            <h4>Code</h4>
<pre><code class="language-html">  &lt!-- html --&gt;
  &lt;multi-selector
    src="data/fallacies.json"
    name="fallacies"&gt;
  &lt;/multi-selector&gt;</code></pre>
        </div>
    </section>

<!-- MARK: disable -->
    <section>
        <div>
            <h3 id="component-behavior">Component behavior and events</h3>
            <p>Control component state with the <code>disabled</code> attribute. Use <code>placeholder</code> to provide helpful text when no selections are made.</p>
            <h4>Change events</h4>
            <p>The component dispatches <code>change</code> events whenever selections change. The event's <code>detail</code> property contains an array of selected values. Open the browser console to see the event data structure.</p>
        </div>
        <div>
            <div>
                <button id="toggle-genres">Toggle</button>
                <multi-selector name="media genres" src="data/lit_and_entertainment.json" placeholder="What are your favorite media genres?" disabled>
                </multi-selector>
            </div>
            <h4>Code</h4>
<pre><code data-theme="dark" class="language-html">  &lt!-- html --&gt;
  &lt;multi-selector
    name="Select genres"
    src="data/genres.json"
    placeholder=
      "What are your favorite media genres?"
    disabled&gt;
  &lt;/multi-selector&gt;</code></pre>
        </div>
    </section>

<!-- MARK: form -->
    <section>
        <div>
            <h3 id="form-integration">Form integration</h3>
            <p><code>&lt;multi-selector&gt;</code> works seamlessly with standard HTML forms. It participates in form submission and validation like any native form control.</p>
            <p>Form data is submitted as a JSON string containing the selected values. For programmatic access, use the <code>selectedValues</code> property which returns a live array.</p>
            <p>Set the <code>name</code> attribute to specify the form field name.</p>
        </div>
        <div>
            <form id="beefheart-form">
                <label for="Albums">Captain Beefheart</label>
                <multi-selector src="data/albums.json" name="albums" placeholder="Select Captain Beefheart Albums...."></multi-selector>
                <button type="submit">submit</button>
            </form>
            <h4>Form data</h4>
            <pre><code id="output" class="language-json"></code></pre>
            <h4>Code</h4>
<pre><code class="language-html">  &lt!-- html --&gt;
  &lt;form&gt;
    &lt;label for="Albums"&gt;Captain Beefheart&lt;/label&gt;
    &lt;multi-selector
      src="data/albums.json"
      name="Albums"
      placeholder=
        "Select Captain Beefheart albums..."&gt;
    &lt;/multi-selector&gt;
    &lt;button type="submit"&gt;submit&lt;/button&gt;
  &lt;/form&gt;</code></pre>
        </div>
    </section>

<!-- MARK: styling -->
    <section>
        <div>
            <h3 id="styling">Styling and theming</h3>
            <p>The component adapts to its environment by inheriting text color and using transparent backgrounds. It automatically derives border colors and interactive states from the inherited color.</p>

            <h4>Dark mode support</h4>
            <p>Set <code>mode="dark"</code> or let the component automatically detect system preference using <code>prefers-color-scheme</code>.</p>

            <h4>Styling approaches</h4>
            <p>Customize appearance using <code>::part()</code> selectors for precise control, or CSS custom properties for simple theming:</p>
            <ul>
                <li><code>::part(container)</code> - Main dropdown container</li>
                <li><code>::part(display)</code> - Selected items display area</li>
                <li><code>::part(options)</code> - Options list container</li>
                <li><code>--ms-*</code> properties - Colors, spacing, and dimensions</li>
            </ul>

            <p>See the <a href="#css-reference">CSS reference</a> for all available custom properties.</p>
        </div>
        <div>
            <div class="styling-example">
                <multi-selector name="soap ingredients" src="data/soaps.json">
                </multi-selector>
            </div>
            <h4>Code</h4>
<pre><code class="language-css">  /* css */
  .styling-example multi-selector {
    --ms-text-color: hsl(0, 5%, 84%);
    --ms-border-color: hsl(120, 24%, 55%);
    --ms-dropdown-background: hsl(120, 24%, 25%);
    --ms-search-background: hsl(120, 24%, 35%);
    --ms-hover: hsl(120, 24%, 30%);
    --ms-search-placeholder-text-color: hsl(0, 5%, 68%);
    width: 300px;
    margin: 0;
  }
  .styling-example multi-selector::part(container) {
    border-width: 2px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }
  .styling-example multi-selector::part(dropdown) {
    background: var(--ms-dropdown-background);
  }
  .styling-example multi-selector::part(options) {
    border-radius: 8px;
    border: 1px solid hsl(120, 24%, 40%);
  }</code></pre>
        </div>
    </section>

<!-- MARK: empty -->
    <section>
        <div>
            <h3 id="empty">Empty state and dynamic data</h3>
            <p>
                Components without initial data display an empty state message and remain disabled until data is provided.
            </p>
            <p>
                Set or update data programmatically using the <code>data</code> property. Assign an array of objects or set to an empty array to clear all options.
            </p>
        </div>
        <div>
            <div>
                <button id="add-data" autocomplete="off">Add data</button>
                <button id="clear-data" autocomplete="off" disabled>Clear data</button>
                <multi-selector name="fruits">
                </multi-selector>
            </div>
            <h4>Code</h4>
<pre><code class="language-html">  &lt!-- html --&gt;
  &lt;button id="add-data"&gt;Add data&lt;/button&gt;
  &lt;button id="clear-data" disabled&gt;Clear data&lt;/button&gt;
  &lt;multi-selector name="fruits"&gt;&lt;/multi-selector&gt;</code></pre>
<pre><code class="language-js">  // javascript
  const fruitSelector = document.querySelector("multi-selector[name='fruits']")
  const addDataButton = document.getElementById("add-data")
  const clearDataButton = document.getElementById("clear-data")

  const fruits = [
      { label: "Apple", value: "apple" },
      { label: "Banana", value: "banana" },
      { label: "Orange", value: "orange" },
      { label: "Grape", value: "grape" },
  ]

  addDataButton.addEventListener("click", () => {
      fruitSelector.data = fruits
      addDataButton.disabled = true
      clearDataButton.disabled = false
  })
  clearDataButton.addEventListener("click", () => {
      fruitSelector.data = []
      clearDataButton.disabled = true
      addDataButton.disabled = false
  })</code></pre>
        </div>
    </section>

<!-- MARK: css reference -->
    <section>
        <div>
            <h3 id="css-reference">CSS Reference</h3>
            <p>Complete reference for styling <code>&lt;multi-selector&gt;</code> components.</p>

            <h4>Custom Properties</h4>
            <p>Use these CSS custom properties for theming:</p>

            <h5>Layout & Spacing</h5>
            <ul>
                <li><code>--ms-height</code> - Component height (default: <code>calc(2rem + var(--ms-padding-block))</code>)</li>
                <li><code>--ms-max-height</code> - Maximum dropdown height (default: <code>60vh</code>)</li>
                <li><code>--ms-padding-block</code> - Vertical padding (default: <code>.25em</code>)</li>
                <li><code>--ms-padding-inline</code> - Horizontal padding (default: <code>1em</code>)</li>
                <li><code>--ms-border-radius</code> - Border radius (default: <code>5px</code>)</li>
            </ul>

            <h5>Base Colors</h5>
            <ul>
                <li><code>--ms-text-color</code> - Main text color (default: <code>inherit</code>)</li>
                <li><code>--ms-border-color</code> - Border color (default: <code>currentColor</code>)</li>
                <li><code>--ms-checkbox-color</code> - Checkbox fill color (default: <code>currentColor</code>)</li>
            </ul>

            <h5>Derived Colors</h5>
            <ul>
                <li><code>--ms-text-color-disabled</code> - Disabled text color</li>
                <li><code>--ms-border-color-disabled</code> - Disabled border color</li>
            </ul>

            <h5>Backgrounds</h5>
            <ul>
                <li><code>--ms-dropdown-background</code> - Dropdown container background</li>
                <li><code>--ms-search-background</code> - Search input background</li>
                <li><code>--ms-hover</code> - Hover state background</li>
            </ul>

            <h5>Button States</h5>
            <ul>
                <li><code>--ms-button-background</code> - Button background</li>
                <li><code>--ms-button-background-hover</code> - Button hover state</li>
                <li><code>--ms-button-background-active</code> - Button active state</li>
            </ul>

            <h5>Search Input</h5>
            <ul>
                <li><code>--ms-search-text-color</code> - Search input text color</li>
                <li><code>--ms-search-placeholder-text-color</code> - Search placeholder color</li>
            </ul>

            <h4>Shadow Parts</h4>
            <p>Use <code>::part()</code> selectors for structural styling:</p>

            <ul>
                <li><code>::part(container)</code> - Main dropdown container (<code>&lt;details&gt;</code>)</li>
                <li><code>::part(display)</code> - Selected items display area</li>
                <li><code>::part(controls)</code> - Control button panel</li>
                <li><code>::part(control-button)</code> - Individual control buttons</li>
                <li><code>::part(dropdown)</code> - Dropdown content area</li>
                <li><code>::part(filter)</code> - Filter/search section</li>
                <li><code>::part(search)</code> - Search input field</li>
                <li><code>::part(options)</code> - Options container</li>
            </ul>

            <h4>Theme Modes</h4>
            <p>The component automatically adapts to dark/light themes:</p>
            <ul>
                <li><code>mode="light"</code> - Force light theme</li>
                <li><code>mode="dark"</code> - Force dark theme</li>
                <li>No mode attribute - Automatically follows <code>prefers-color-scheme</code></li>
            </ul>

            <h4>Styling Priority</h4>
            <p>When both custom properties and <code>::part()</code> rules target the same property, <code>::part()</code> rules win due to higher CSS specificity. Use <code>::part()</code> for precise control and custom properties for theming.</p>
        </div>

<!-- MARK: alternatives -->
        <div>
            <h3 id="alternatives">Alternatives</h3>
            <ul>
                <li>
                    <a href="https://bmsvieira.github.io/BVSelect-VanillaJS/">BVSelect </a>
                </li>
                <li>
                    <a href="https://vorotina.github.io/vanilla-select/">vanilla-select</a>
                </li>
                <li>
                    <a href="https://philippemarcmeyer.github.io/vanillaSelectBox/index.html?v=1.04">vanillaSelectBox</a>
                </li>
                <li>
                    <a href="https://multiselect-combo-box.web.app/">multiselect-combo-box</a> <code><a href="https://github.com/gatanaso/multiselect-combo-box">github</a></code>
                </li>
                <li>
                    <a href="https://paper-dropdown.netlify.app/#/elements/paper-dropdown/demos/demo/index.html">paper-dropdown</a> <code><a href="https://github.com/pushkar8723/paper-dropdown">github</a></code>
                </li>
            </ul>
        </div>
    </section>
</main>
<button class="back-to-top" id="back-to-top" aria-label="Back to top">↑</button>
<!-- MARK: scripts -->
<script src="static/prism.js"></script>
<script src="src/wc-multi-selector.js"></script>
<script type="module">
    import { DarkModeToggle } from "https://uu-asc.github.io/csa-werkvoorraad/src/darkmode-toggle.js"

    const multiSelectors = document.querySelectorAll("multi-selector")

    document.addEventListener("color-scheme-change", event => {
        event.detail.scheme === "dark"
        ? document.body.classList.add("dark-theme")
        : document.body.classList.remove("dark-theme")

        multiSelectors.forEach(el => {
            const hasDark = document.body.classList.contains("dark-theme")
            el.mode = hasDark ? "dark" : "light"
        })
    })
    const darkModeToggle = new DarkModeToggle()
    document.querySelector("header").appendChild(darkModeToggle)

    // test options through markup
    const colorInput = document.getElementById("color")
    const addColorButton = document.getElementById("add-color")
    const colorOptions = document.querySelector("[name='colors']")

    function addColor() {
        const val = colorInput.value
        console.log(colorOptions.options)
        if (!val || colorOptions.options.includes(val)) { return }
        const newOption = document.createElement("option")
        newOption.textContent = val
        colorOptions.appendChild(newOption)
        colorInput.value = ""
    }

    colorInput.addEventListener("keyup", (event) => {
        if (event.code === "Enter") { addColor() }
    })

    addColorButton.addEventListener("click", addColor)

    // test disabled
    const toggle = document.getElementById("toggle-genres")
    const genres = document.querySelector("multi-selector[name='media genres']")
    toggle.addEventListener("click", () => genres.toggleAttribute("disabled"))

    genres.addEventListener("change", event => console.log("Change event detected, containing the following selected values:", event.detail))

    // test set and clear data
    const fruitSelector = document.querySelector("multi-selector[name='fruits']")
    const addDataButton = document.getElementById("add-data")
    const clearDataButton = document.getElementById("clear-data")

    const fruits = [
        { label: "Apple", value: "apple" },
        { label: "Banana", value: "banana" },
        { label: "Orange", value: "orange" },
        { label: "Grape", value: "grape" },
    ]

    addDataButton.addEventListener("click", () => {
        fruitSelector.data = fruits
        addDataButton.disabled = true
        clearDataButton.disabled = false
    })
    clearDataButton.addEventListener("click", () => {
        fruitSelector.data = []
        clearDataButton.disabled = true
        addDataButton.disabled = false
    })

    // test form
    const output = document.getElementById("output")
    const form = document.getElementById("beefheart-form")
    form.addEventListener("submit", event => {
        event.preventDefault()
        const formData = new FormData(form)
        console.log(formData)
        const data = {}
        formData.forEach((value, key) => data[key] = value)
        output.innerHTML = JSON.stringify(data, null, 2)
    })

    // back to top
    const backToTopButton = document.getElementById("back-to-top")
    const main = document.querySelector("main")

    main.addEventListener("scroll", () => {
        const scrollY = main.scrollTop

        if (scrollY > 300) {
            backToTopButton.classList.add("visible")
        } else {
            backToTopButton.classList.remove("visible")
        }
    })

    backToTopButton.addEventListener("click", () => {
        main.scrollTo({ top: 0, behavior: "smooth" })
    })
</script>
</body>
</html>
